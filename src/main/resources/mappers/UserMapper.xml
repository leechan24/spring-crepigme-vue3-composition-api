<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.maple.info.mapper.UserMapper">

    <select id="findById" parameterType="string" resultType="com.maple.info.vo.UserVo">
      SELECT USER_ID as userId,
               USERNAME as username,
               PASSWORD_HASH as passwordHash,
               EMAIL as email,
               STATUS as status,
               PHONE_NUMBER as phoneNumber,
               CREATED_AT as createdAt,
               UPDATED_AT as updatedAt,
               REFRESH_TOKEN as refreshToken
        FROM USERS
        WHERE USER_ID = #{userId}
    </select>

	<!-- Refresh Token 업데이트 -->
    <update id="updateRefreshToken" parameterType="com.maple.info.vo.UserVo">
        UPDATE USERS
        SET REFRESH_TOKEN = 
    	<choose>
            <when test="refreshToken != null">
                #{refreshToken}
            </when>
            <otherwise>
                NULL
            </otherwise>
        </choose>,
            UPDATED_AT = SYSTIMESTAMP
        WHERE USER_ID = #{userId}
    </update>
    
    <select id="findByRefreshToken" parameterType="string" resultType="com.maple.info.vo.UserVo">
        SELECT USER_ID AS userId,
               USERNAME AS username,
               PASSWORD_HASH AS passwordHash,
               EMAIL AS email,
               STATUS AS status,
               CREATED_AT AS createdAt,
               UPDATED_AT AS updatedAt,
               REFRESH_TOKEN AS refreshToken
        FROM USERS
        WHERE REFRESH_TOKEN = #{refreshToken}
    </select>
    
    <insert id="insertUser" parameterType="com.maple.info.vo.UserVo">
      INSERT INTO USERS (USER_ID, USERNAME, PASSWORD_HASH, EMAIL, STATUS, PHONE_NUMBER)
    	VALUES  (#{userId}, #{username}, #{passwordHash}, #{email}, #{status}, #{phoneNumber})
    </insert>

</mapper>